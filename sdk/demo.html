<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics SDK Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #2563eb;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            background: #e0f2fe;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
        }
        .info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Real-Time Analytics SDK Demo</h1>
        <p>This page demonstrates the JavaScript SDK in action. Events are sent to the ingestion API and appear in the dashboard within seconds!</p>

        <div class="section">
            <h3>Visitor Information</h3>
            <p class="info">
                <strong>Visitor ID:</strong> <span id="visitorId">Loading...</span><br>
                <strong>Session ID:</strong> <span id="sessionId">Loading...</span>
            </p>
        </div>

        <div class="section">
            <h3>Track Page Views</h3>
            <button onclick="trackPageView()">Track Page View</button>
            <p class="info">Page views are tracked automatically, but you can also track them manually.</p>
        </div>

        <div class="section">
            <h3>Track Button Clicks</h3>
            <button onclick="trackClick('demo_button_1')">Track Click: Button 1</button>
            <button onclick="trackClick('demo_button_2')">Track Click: Button 2</button>
            <button onclick="trackClick('demo_button_3')">Track Click: Button 3</button>
        </div>

        <div class="section">
            <h3>Track Form Submission</h3>
            <input type="text" id="demoInput" placeholder="Enter something...">
            <button onclick="trackFormSubmit()">Submit Form</button>
        </div>

        <div class="section">
            <h3>Track Custom Events</h3>
            <select id="eventType">
                <option value="cart_add">Cart Add</option>
                <option value="cart_abandon">Cart Abandon</option>
                <option value="pricing_view">Pricing View</option>
                <option value="signup_start">Signup Start</option>
            </select>
            <button onclick="trackCustomEvent()">Track Event</button>
        </div>

        <div class="section">
            <h3>Identify User (Login Simulation)</h3>
            <input type="text" id="userId" placeholder="Enter user ID...">
            <button onclick="identifyUser()">Identify User</button>
            <p class="info">This stitches the anonymous visitor to a known user ID.</p>
        </div>

        <div class="section">
            <h3>Load Testing</h3>
            <input type="number" id="numEvents" value="10" min="1" max="100">
            <button onclick="sendBulkEvents()">Send Bulk Events</button>
            <p class="info">Sends multiple events to test pipeline throughput.</p>
        </div>

        <div id="status" class="status" style="display: none;">
            <strong>Status:</strong> <span id="statusText"></span>
        </div>
    </div>

    <script src="tracker.js"></script>
    <script>
        // Initialize tracker
        const analytics = new AnalyticsTracker({
            apiUrl: 'http://localhost:8000',
            customerId: 'demo_tenant',
            batchSize: 5,
            flushInterval: 5000,
            debug: true,
            autoTrackPageViews: true
        });

        // Display visitor and session info
        document.getElementById('visitorId').textContent = analytics.visitorId;
        document.getElementById('sessionId').textContent = analytics.sessionId;

        function showStatus(message) {
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        function trackPageView() {
            analytics.page({
                page: '/demo',
                title: 'SDK Demo Page'
            });
            showStatus('Page view tracked!');
        }

        function trackClick(buttonId) {
            analytics.click(buttonId, {
                position: 'demo_section',
                button_text: `Button ${buttonId.split('_').pop()}`
            });
            showStatus(`Click tracked: ${buttonId}`);
        }

        function trackFormSubmit() {
            const inputValue = document.getElementById('demoInput').value;
            analytics.formSubmit('demo_form', {
                field_count: 1,
                has_value: inputValue.length > 0
            });
            showStatus('Form submission tracked!');
        }

        function trackCustomEvent() {
            const eventType = document.getElementById('eventType').value;
            analytics.track(eventType, `Custom Event: ${eventType}`, {
                source: 'demo_page',
                timestamp: new Date().toISOString()
            });
            showStatus(`Custom event tracked: ${eventType}`);
        }

        function identifyUser() {
            const userId = document.getElementById('userId').value;
            if (userId) {
                analytics.identify(userId, {
                    source: 'demo_page',
                    identified_at: new Date().toISOString()
                });
                showStatus(`User identified: ${userId}`);
            } else {
                alert('Please enter a user ID');
            }
        }

        function sendBulkEvents() {
            const numEvents = parseInt(document.getElementById('numEvents').value);
            const eventTypes = ['page_view', 'button_click', 'form_submit', 'cart_add', 'pricing_view'];

            for (let i = 0; i < numEvents; i++) {
                const eventType = eventTypes[Math.floor(Math.random() * eventTypes.length)];
                analytics.track(eventType, `Bulk Event ${i + 1}`, {
                    bulk_test: true,
                    index: i,
                    total: numEvents
                });
            }

            analytics.flush();
            showStatus(`Sent ${numEvents} events!`);
        }

        // Track when user leaves the page
        window.addEventListener('beforeunload', () => {
            analytics.track('page_exit', 'Page Exit', {
                time_on_page: Date.now() - window.performance.timing.navigationStart
            });
        });

        console.log('Analytics SDK Demo initialized!');
        console.log('Open the dashboard at http://localhost:5173 to see events in real-time');
    </script>
</body>
</html>
